---
layout: default
title: Accueil
---

<div class="page-header">
  <h2>Nos Dernières Découvertes</h2>
  <p>Explorez nos critiques de restaurants à Sherbrooke</p>
</div>

<div class="content-wrapper">
  <div class="filters-sidebar">
    <div class="filter-group">
      <h3>Filtres</h3>
      <label for="sort-by">Trier par</label>
      <select id="sort-by" class="filter-select">
        <option value="name-asc">Nom (A-Z)</option>
        <option value="name-desc">Nom (Z-A)</option>
        <option value="date-desc">Date (récent-vieux)</option>
        <option value="date-asc">Date (vieux-récent)</option>
        <option value="rating-desc">Note (plus élevé à faible)</option>
        <option value="rating-asc">Note (faible à plus élevé)</option>
      </select>

      <label for="style-filter">Style de cuisine</label>
      <select id="style-filter" class="filter-select">
        <option value="">Tous les styles</option>
        <option value="Asiatique">Asiatique</option>
        <option value="Italien">Italien</option>
        <option value="Mexicain">Mexicain</option>
        <option value="Bistro">Bistro</option>
        <option value="Américain">Américain</option>
        <option value="Libano-Marocain">Libano-Marocain</option>
        <option value="Iranien">Iranien</option>
        <option value="Vietnamien">Vietnamien</option>
        <option value="Thaïlandais">Thaïlandais</option>
        <option value="Indien">Indien</option>
        <option value="Café-Bistro">Café-Bistro</option>
        <option value="Microbrasserie">Microbrasserie</option>
        <option value="Pub">Pub</option>
        <option value="Boulangerie-Café">Boulangerie-Café</option>
      </select>

      <label for="price-filter">Fourchette de prix</label>
      <select id="price-filter" class="filter-select">
        <option value="">Tous les prix</option>
        <option value="$ (0-20$)">$ (0-20$)</option>
        <option value="$$ (20-40$)">$$ (20-40$)</option>
        <option value="$$$ (40$ et +)">$$$ (40$ et +)</option>
      </select>

      <label>Régime alimentaire</label>
      <div class="diet-options">
        <div class="diet-option">
          <input type="checkbox" id="vegetarian-option" value="vegetarian-friendly">
          <label for="vegetarian-option">Options végétariennes</label>
        </div>
        <div class="diet-option">
          <input type="checkbox" id="vegan-option" value="vegan-friendly">
          <label for="vegan-option">Options végétaliennes</label>
        </div>
      </div>
    </div>
  </div>

  <div class="post-grid" id="restaurant-grid">
    {% for post in site.posts %}
      {% if post.layout == 'restaurant' %}
      <div class="post-card" data-date="{{ post.date | date: '%Y-%m-%d' }}" data-rating="{{ post.note }}" data-style="{{ post.style }}" data-price="{{ post.price }}" data-diet="{{ post.diet }}">
        <a href="{{ post.url | relative_url }}" class="post-link">
          <div class="post-image" style="background-image: url('{{ post.image }}')"></div>
          <div class="content">
            <h2>{{ post.title }}</h2>
            <div class="rating">
              <span class="stars">
                {% assign rating = post.note | default: 0 %}
                {% for i in (1..5) %}
                  {% if i <= rating %}
                    ⭐
                  {% endif %}
                {% endfor %}
              </span>
              <span class="score">{{ rating }}/5</span>
            </div>
            <p class="description">{{ post.description | truncate: 150 }}</p>
            <div class="meta">
              <span class="date"><i class="far fa-calendar"></i> {{ post.date | date: "%d %b %Y" }}</span>
              {% if post.style %}
              <span class="cuisine-style"><i class="fas fa-utensils"></i> {{ post.style }}</span>
              {% endif %}
            </div>
          </div>
        </a>
      </div>
      {% endif %}
    {% endfor %}
  </div>
</div>

<style>
.diet-options {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.diet-option {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.diet-option input[type="checkbox"] {
  width: 16px;
  height: 16px;
  cursor: pointer;
}

.diet-option label {
  cursor: pointer;
  font-size: 0.9rem;
}
</style>

<script>
  // Restore scroll position when returning to the page
  window.addEventListener('load', function() {
    const scrollPosition = sessionStorage.getItem('scrollPosition');
    if (scrollPosition) {
      window.scrollTo(0, parseInt(scrollPosition));
      sessionStorage.removeItem('scrollPosition');
    }
  });

  // Filtering functionality
  const sortSelect = document.getElementById('sort-by');
  const styleFilter = document.getElementById('style-filter');
  const priceFilter = document.getElementById('price-filter');
  const vegetarianOption = document.getElementById('vegetarian-option');
  const veganOption = document.getElementById('vegan-option');
  const restaurantGrid = document.getElementById('restaurant-grid');
  let restaurants = Array.from(restaurantGrid.children);

  function filterRestaurants() {
    const selectedStyle = styleFilter.value;
    const selectedPrice = priceFilter.value;
    const isVegetarianChecked = vegetarianOption.checked;
    const isVeganChecked = veganOption.checked;
    const sortValue = sortSelect.value;

    // Filter by style, price and diet
    let filteredRestaurants = restaurants.filter(restaurant => {
      const style = restaurant.dataset.style;
      const price = restaurant.dataset.price;
      const diet = restaurant.dataset.diet;
      
      const styleMatch = !selectedStyle || style === selectedStyle;
      const priceMatch = !selectedPrice || price === selectedPrice;
      
      // Gestion du régime alimentaire
      let dietMatch = true;
      if (isVegetarianChecked || isVeganChecked) {
        dietMatch = false;
        if (isVegetarianChecked && (diet === 'vegetarian-friendly' || diet === 'vegetarian' || diet === 'vegan')) {
          dietMatch = true;
        }
        if (isVeganChecked && (diet === 'vegan-friendly' || diet === 'vegan')) {
          dietMatch = true;
        }
      }
      
      return styleMatch && priceMatch && dietMatch;
    });

    // Sort filtered restaurants
    filteredRestaurants.sort((a, b) => {
      switch(sortValue) {
        case 'date-desc':
          return new Date(b.dataset.date) - new Date(a.dataset.date);
        case 'date-asc':
          return new Date(a.dataset.date) - new Date(b.dataset.date);
        case 'name-asc':
          return a.querySelector('h2').textContent.localeCompare(b.querySelector('h2').textContent);
        case 'name-desc':
          return b.querySelector('h2').textContent.localeCompare(a.querySelector('h2').textContent);
        case 'rating-desc':
          return parseFloat(b.dataset.rating) - parseFloat(a.dataset.rating);
        case 'rating-asc':
          return parseFloat(a.dataset.rating) - parseFloat(b.dataset.rating);
        default:
          return 0;
      }
    });

    // Update the grid
    restaurantGrid.innerHTML = '';
    filteredRestaurants.forEach(restaurant => {
      restaurantGrid.appendChild(restaurant);
    });
  }

  // Add event listeners
  sortSelect.addEventListener('change', filterRestaurants);
  styleFilter.addEventListener('change', filterRestaurants);
  priceFilter.addEventListener('change', filterRestaurants);
  vegetarianOption.addEventListener('change', filterRestaurants);
  veganOption.addEventListener('change', filterRestaurants);

  document.addEventListener('DOMContentLoaded', function() {
    const sortSelect = document.getElementById('sort-by');
    const restaurantGrid = document.getElementById('restaurant-grid');
    let restaurants = Array.from(restaurantGrid.children);

    function sortRestaurants() {
      const sortBy = sortSelect.value;
      
      restaurants.sort((a, b) => {
        const titleA = a.querySelector('h2').textContent;
        const titleB = b.querySelector('h2').textContent;
        const dateA = new Date(a.dataset.date);
        const dateB = new Date(b.dataset.date);
        const ratingA = parseFloat(a.dataset.rating);
        const ratingB = parseFloat(b.dataset.rating);

        switch(sortBy) {
          case 'name-asc':
            return titleA.localeCompare(titleB, 'fr');
          case 'name-desc':
            return titleB.localeCompare(titleA, 'fr');
          case 'date-desc':
            return dateB - dateA;
          case 'date-asc':
            return dateA - dateB;
          case 'rating-desc':
            return ratingB - ratingA;
          case 'rating-asc':
            return ratingA - ratingB;
          default:
            return 0;
        }
      });

      // Réorganiser les restaurants dans la grille
      restaurantGrid.innerHTML = '';
      restaurants.forEach(restaurant => {
        restaurantGrid.appendChild(restaurant);
      });
    }

    // Écouter les changements de tri
    sortSelect.addEventListener('change', sortRestaurants);
  });
</script>
